<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <meta name="theme-color" content="#050d14"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="WeltkindVPN"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <link rel="icon" href="icons/icon-192.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet"/>
  <title>WeltkindVPN</title>
  <style>
    :root{--bg:#050d14;--surface:#0a1929;--card:#0d2137;--accent:#00e676;--accent2:#00b0ff;--warn:#ff6d00;--text:#e0f7fa;--muted:#546e7a;--border:rgba(0,230,118,.12);}
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;overflow:hidden;background:var(--bg);font-family:'Rajdhani',sans-serif;color:var(--text)}
    #bg-canvas{position:fixed;inset:0;z-index:0;opacity:.3}
    #splash{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .6s ease}
    #splash.out{opacity:0;pointer-events:none}
    .vpn-orb{position:relative;width:140px;height:140px;margin-bottom:28px}
    .orb-core{position:absolute;inset:30px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#00e676,#005f2d);box-shadow:0 0 40px rgba(0,230,118,.8);animation:op 2.5s ease-in-out infinite}
    .orb-ring{position:absolute;inset:0;border-radius:50%;border:2px solid rgba(0,230,118,.5);animation:re 2.5s ease-out infinite}
    .orb-ring:nth-child(2){animation-delay:.8s}
    .orb-ring:nth-child(3){animation-delay:1.6s}
    @keyframes op{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    @keyframes re{0%{transform:scale(.6);opacity:.8}100%{transform:scale(1.7);opacity:0}}
    .splash-brand{font-size:2.2rem;font-weight:700;letter-spacing:.08em;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .splash-sub{margin-top:8px;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--muted);letter-spacing:.15em}
    .splash-bar{margin-top:32px;width:160px;height:2px;background:rgba(0,230,118,.12);border-radius:2px;overflow:hidden}
    .splash-bar-fill{height:100%;width:0%;background:var(--accent);border-radius:2px;animation:bf 2.2s ease forwards}
    @keyframes bf{to{width:100%}}
    #hdr{position:fixed;top:0;left:0;right:0;height:52px;z-index:200;background:rgba(5,13,20,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 16px}
    .hdr-brand{font-size:1.1rem;font-weight:700;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .hdr-right{display:flex;align-items:center;gap:10px}
    .conn-pill{display:flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;background:rgba(0,230,118,.08);border:1px solid rgba(0,230,118,.2);font-family:'JetBrains Mono',monospace;font-size:.62rem;color:var(--accent);cursor:pointer}
    .conn-dot{width:6px;height:6px;border-radius:50%;background:var(--warn);animation:blink 2s infinite}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
    .bell-btn{position:relative;width:36px;height:36px;border-radius:10px;background:rgba(0,176,255,.08);border:1px solid rgba(0,176,255,.2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.1rem;transition:background .2s}
    .bell-btn:hover{background:rgba(0,176,255,.2)}
    .bell-badge{position:absolute;top:4px;right:4px;width:8px;height:8px;background:var(--warn);border-radius:50%;border:1px solid var(--bg);display:none}
    .bell-badge.show{display:block}
    #frame-wrap{position:fixed;top:52px;left:0;right:0;bottom:0;z-index:10}
    #main-frame{width:100%;height:100%;border:none;display:block;opacity:0;transition:opacity .5s}
    #main-frame.loaded{opacity:1}
    #notif-panel{position:fixed;top:60px;right:12px;z-index:500;width:min(310px,90vw);background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 16px 48px rgba(0,0,0,.7);transform:translateY(-20px) scale(.95);opacity:0;pointer-events:none;transition:all .3s cubic-bezier(.34,1.56,.64,1)}
    #notif-panel.open{transform:translateY(0) scale(1);opacity:1;pointer-events:all}
    .np-title{font-size:1rem;font-weight:700;margin-bottom:14px}
    .np-label{font-family:'JetBrains Mono',monospace;font-size:.63rem;color:var(--muted);letter-spacing:.1em;margin-bottom:6px}
    .np-section{margin-bottom:12px}
    .np-input{width:100%;padding:9px 12px;border-radius:9px;background:rgba(0,230,118,.05);border:1px solid var(--border);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.8rem;outline:none;transition:border .2s}
    .np-input:focus{border-color:var(--accent)}
    .np-btn{width:100%;padding:10px;border-radius:10px;border:none;font-family:'Rajdhani',sans-serif;font-size:.95rem;font-weight:700;cursor:pointer;transition:all .2s;margin-bottom:8px}
    .np-btn-green{background:linear-gradient(135deg,var(--accent),#00b300);color:#000}
    .np-btn-green:hover{box-shadow:0 0 20px rgba(0,230,118,.4);transform:translateY(-1px)}
    .np-btn-blue{background:rgba(0,176,255,.1);border:1px solid rgba(0,176,255,.25);color:var(--accent2)}
    .np-status{font-family:'JetBrains Mono',monospace;font-size:.72rem;margin-top:10px;padding:8px 10px;border-radius:8px;background:rgba(0,230,118,.05);border:1px solid var(--border);display:none}
    .np-status.show{display:block}
    .np-status.ok{color:var(--accent);border-color:rgba(0,230,118,.3)}
    .np-status.warn{color:var(--warn);border-color:rgba(255,109,0,.3)}
    .np-status.err{color:#ff1744;border-color:rgba(255,23,68,.3)}
    #install-banner{display:none;position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:var(--card);border:1px solid rgba(0,230,118,.25);border-radius:14px;padding:12px 16px;flex-direction:row;align-items:center;gap:12px;z-index:400;box-shadow:0 8px 32px rgba(0,0,0,.6);min-width:260px;max-width:90vw;animation:su .4s cubic-bezier(.34,1.56,.64,1)}
    @keyframes su{from{transform:translateX(-50%) translateY(80px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}
    #install-banner.show{display:flex}
    .ib-icon{font-size:1.7rem}
    .ib-text{flex:1}
    .ib-text strong{display:block;font-size:.95rem;font-weight:700}
    .ib-text span{font-size:.7rem;color:var(--muted);font-family:'JetBrains Mono',monospace}
    .ib-install{padding:8px 16px;background:linear-gradient(135deg,var(--accent),#00b300);border:none;border-radius:100px;color:#000;font-family:'Rajdhani',sans-serif;font-size:.85rem;font-weight:700;cursor:pointer}
    .ib-close{background:none;border:none;color:var(--muted);cursor:pointer;font-size:1rem}
    #dimmer{position:fixed;inset:0;z-index:450;background:rgba(0,0,0,.5);display:none;backdrop-filter:blur(2px)}
    #dimmer.show{display:block}
  </style>
</head>
<body>
<canvas id="bg-canvas"></canvas>
<div id="splash">
  <div class="vpn-orb">
    <div class="orb-ring"></div><div class="orb-ring"></div><div class="orb-ring"></div>
    <div class="orb-core"></div>
  </div>
  <div class="splash-brand">WELTKIND VPN</div>
  <div class="splash-sub">SECURE ¬∑ PRIVATE ¬∑ FAST</div>
  <div class="splash-bar"><div class="splash-bar-fill"></div></div>
</div>
<header id="hdr">
  <div class="hdr-brand">‚ö° WeltkindVPN</div>
  <div class="hdr-right">
    <div class="conn-pill">
      <div class="conn-dot" id="conn-dot"></div>
      <span id="conn-text">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    <div class="bell-btn" id="bell-btn" onclick="togglePanel()">üîî
      <div class="bell-badge" id="bell-badge"></div>
    </div>
  </div>
</header>
<div id="dimmer" onclick="closePanel()"></div>
<div id="notif-panel">
  <div class="np-title">üîî Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
  <div class="np-section">
    <div class="np-label">–î–ê–¢–ê –û–ö–û–ù–ß–ê–ù–ò–Ø –ü–û–î–ü–ò–°–ö–ò</div>
    <input type="date" id="np-date" class="np-input"/>
  </div>
  <button class="np-btn np-btn-green" onclick="saveNotif()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–∫–ª—é—á–∏—Ç—å</button>
  <button class="np-btn np-btn-blue" onclick="testNotif()">üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
  <div id="np-status" class="np-status"></div>
</div>
<div id="frame-wrap">
  <iframe id="main-frame"
    src="https://script.google.com/macros/s/AKfycbxfUBsBIMK6qULmIlqfxoOR9bWtjmc4uofYt3jWjGMd0Ql8kL4u32a7I9cgl22N3pJt8g/exec"
    title="WeltkindVPN"
    sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-modals">
  </iframe>
</div>
<div id="install-banner">
  <div class="ib-icon">üì≤</div>
  <div class="ib-text"><strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</strong><span>–†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ</span></div>
  <button class="ib-install" id="install-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
  <button class="ib-close" onclick="document.getElementById('install-banner').classList.remove('show')">‚úï</button>
</div>
<script>
// Matrix canvas
(function(){
  const c=document.getElementById('bg-canvas'),ctx=c.getContext('2d');
  let cols,drops;
  const chars='01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±';
  function resize(){c.width=innerWidth;c.height=innerHeight;cols=Math.floor(c.width/18);drops=Array(cols).fill(1);}
  function draw(){ctx.fillStyle='rgba(5,13,20,.06)';ctx.fillRect(0,0,c.width,c.height);ctx.fillStyle='#00e676';ctx.font='13px monospace';for(let i=0;i<drops.length;i++){ctx.fillText(chars[Math.floor(Math.random()*chars.length)],i*18,drops[i]*18);if(drops[i]*18>c.height&&Math.random()>.975)drops[i]=0;drops[i]++;}}
  resize();window.addEventListener('resize',resize);setInterval(draw,55);
})();

// Iframe load
const frame=document.getElementById('main-frame');
const dot=document.getElementById('conn-dot');
const txt=document.getElementById('conn-text');
let t=setTimeout(()=>{document.getElementById('splash').classList.add('out');dot.style.background='var(--warn)';txt.textContent='–º–µ–¥–ª–µ–Ω–Ω–æ';},9000);
frame.addEventListener('load',()=>{
  clearTimeout(t);frame.classList.add('loaded');
  setTimeout(()=>document.getElementById('splash').classList.add('out'),400);
  dot.style.background='var(--accent)';dot.style.boxShadow='0 0 8px var(--accent)';txt.textContent='–∞–∫—Ç–∏–≤–µ–Ω';
  checkExpiry();
});

// SW
if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});

// Panel
function togglePanel(){const p=document.getElementById('notif-panel'),d=document.getElementById('dimmer');if(p.classList.contains('open')){closePanel();}else{p.classList.add('open');d.classList.add('show');const s=JSON.parse(localStorage.getItem('vpn_s')||'{}');if(s.date)document.getElementById('np-date').value=s.date;}}
function closePanel(){document.getElementById('notif-panel').classList.remove('open');document.getElementById('dimmer').classList.remove('show');}

// Save
async function saveNotif(){
  const date=document.getElementById('np-date').value;
  if(!date){showSt('‚ö†Ô∏è –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É','warn');return;}
  let p=Notification.permission;
  if(p==='default')p=await Notification.requestPermission();
  if(p==='denied'){showSt('‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –±—Ä–∞—É–∑–µ—Ä–æ–º','err');return;}
  localStorage.setItem('vpn_s',JSON.stringify({date,savedAt:Date.now()}));
  showSt('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –£–≤–µ–¥–æ–º–ª—é –∑–∞ 3 –¥–Ω—è –¥–æ –∫–æ–Ω—Ü–∞','ok');
  document.getElementById('bell-badge').classList.add('show');
  checkExpiry();
}

async function testNotif(){
  let p=Notification.permission;
  if(p==='default')p=await Notification.requestPermission();
  if(p==='denied'){showSt('‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º','err');return;}
  setTimeout(()=>{
    const n=new Notification('‚úÖ WeltkindVPN ‚Äî —Ç–µ—Å—Ç',{body:'–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç! –í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.',icon:'icons/icon-192.png',tag:'vpn-test'});
    n.onclick=()=>{window.focus();n.close();};
  },500);
  showSt('üì¨ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!','ok');
}

function checkExpiry(){
  const s=JSON.parse(localStorage.getItem('vpn_s')||'{}');
  if(!s.date)return;
  const days=Math.ceil((new Date(s.date)-Date.now())/86400000);
  if(days<=3&&Notification.permission==='granted'){
    const title=days<=0?'üö® –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞!':`‚ö†Ô∏è –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ ${days} –¥–Ω.`;
    const body=days<=0?'–ü—Ä–æ–¥–ª–∏—Ç–µ VPN –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!':'–ó–∞–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.';
    setTimeout(()=>{
      const n=new Notification(title,{body,icon:'icons/icon-192.png',tag:'vpn-expiry',renotify:true,vibrate:[200,100,200]});
      n.onclick=()=>{window.focus();n.close();};
    },1500);
    document.getElementById('bell-badge').classList.add('show');
  }
}

function showSt(msg,type){const e=document.getElementById('np-status');e.textContent=msg;e.className='np-status show '+type;}

// PWA install
let dp=null;
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();dp=e;setTimeout(()=>document.getElementById('install-banner').classList.add('show'),4000);});
document.getElementById('install-btn').onclick=async()=>{document.getElementById('install-banner').classList.remove('show');if(dp){dp.prompt();await dp.userChoice;dp=null;}};
window.addEventListener('appinstalled',()=>document.getElementById('install-banner').classList.remove('show'));

setInterval(checkExpiry,3600000);
</script>
</body>
</html>
